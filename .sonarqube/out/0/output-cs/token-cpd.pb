š
?D:\temp\UrlShortener\UrlShortener\Controllers\HomeController.cs
	namespace 	
UrlShortener
 
. 
Controllers "
{ 
public 

class 
HomeController 
:  !

Controller" ,
{ 
readonly		 
UrlShortenerContext		 $
	dbContext		% .
;		. /
public 
HomeController 
( 
UrlShortenerContext 1
context2 9
)9 :
{ 	
	dbContext 
= 
context 
;  
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
RedirectToAction #
(# $
$str$ +
,+ ,
$str- ;
); <
;< =
} 	
[ 	
Route	 
( 
$str +
)+ ,
], -
public 
IActionResult 
UserShortedUrl +
(+ ,
string, 2

shortedUrl3 =
)= >
{ 	
var 
urls 
= 
	dbContext !
.! "
Urls" &
.& '
ToList' -
(- .
). /
;/ 0
var 
urlItem 
= 
urls 
. 
FirstOrDefault -
(- .
url. 1
=>2 4
url5 8
.8 9

ShortedUrl9 C
.C D
ContainsD L
(L M

shortedUrlM W
)W X
)X Y
;Y Z
if 
( 
urlItem 
== 
null 
)  
return! '
RedirectToAction( 8
(8 9
$str9 @
,@ A
$strB P
)P Q
;Q R
urlItem 
. 
Clics 
++ 
; 
	dbContext 
. 
Urls 
. 
Update !
(! "
urlItem" )
)) *
;* +
	dbContext 
. 
SaveChanges !
(! "
)" #
;# $
return   
Redirect   
(   
urlItem   #
.  # $
UserUrl  $ +
)  + ,
;  , -
}!! 	
}"" 
}## æ)
GD:\temp\UrlShortener\UrlShortener\Controllers\UrlShortenerController.cs
	namespace 	
UrlShortener
 
. 
Controllers "
{		 
public

 

class

 "
UrlShortenerController

 '
:

( )

Controller

* 4
{ 
readonly 
UrlShortenerContext $
	dbContext% .
;. /
public "
UrlShortenerController %
(% &
UrlShortenerContext& 9
context: A
)A B
{ 	
	dbContext 
= 
context 
;  
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
GetUrlViewModels (
(( )
)) *
)* +
;+ ,
} 	
[ 	
HttpPost	 
] 
public 
ActionResult 
ShortUrl $
($ %
List% )
<) *
UrlViewModel* 6
>6 7
urls8 <
)< =
{ 	
var 

newUserUrl 
= 
urls !
.! "
FirstOrDefault" 0
(0 1
url1 4
=>5 7
url8 ;
.; <
Id< >
==? A
nullB F
)F G
.G H
UserUrlH O
;O P
if 
( 
! 
string 
. 
IsNullOrWhiteSpace *
(* +

newUserUrl+ 5
)5 6
)6 7
{ 
var 
newUrl 
= 
new  
Url! $
{% &
UserUrl' .
=/ 0

newUserUrl1 ;
,; <
Clics= B
=C D
$numE F
}G H
;H I
newUrl   
.   

ShortedUrl   !
=  " #
Request  $ +
.  + ,
Scheme  , 2
+  3 4
$str  5 :
+  ; <
Request  = D
.  D E
Host  E I
+  J K
$str  L O
+  P Q
GetRandomString  R a
(  a b
)  b c
;  c d
	dbContext!! 
.!! 
Urls!! 
.!! 
Add!! "
(!!" #
newUrl!!# )
)!!) *
;!!* +
	dbContext"" 
."" 
SaveChanges"" %
(""% &
)""& '
;""' (
}## 
return%% 
PartialView%% 
(%% 
$str%% ,
,%%, -
GetUrlViewModels%%. >
(%%> ?
)%%? @
)%%@ A
;%%A B
}&& 	
private(( 
IEnumerable(( 
<(( 
UrlViewModel(( (
>((( )
GetUrlViewModels((* :
(((: ;
)((; <
{)) 	
var** 
urlViewModelList**  
=**! "
new**# &
List**' +
<**+ ,
UrlViewModel**, 8
>**8 9
(**9 :
)**: ;
;**; <
var++ 
urls++ 
=++ 
	dbContext++  
.++  !
Urls++! %
.++% &
ToList++& ,
(++, -
)++- .
;++. /
foreach-- 
(-- 
var-- 
url-- 
in-- 
urls--  $
)--$ %
{.. 
urlViewModelList//  
.//  !
Add//! $
(//$ %
new//% (
UrlViewModel//) 5
{//6 7
Id//8 :
=//; <
url//= @
.//@ A
Id//A C
,//C D
UserUrl//E L
=//M N
url//O R
.//R S
UserUrl//S Z
,//Z [

ShortedUrl//\ f
=//g h
url//i l
.//l m

ShortedUrl//m w
,//w x
Clics//y ~
=	// €
url
// „
.
//„ …
Clics
//… Š
}
//‹ Œ
)
//Œ 
;
// Ž
}00 
urlViewModelList22 
.22 
Add22  
(22  !
new22! $
UrlViewModel22% 1
{222 3
Id224 6
=227 8
null229 =
}22> ?
)22? @
;22@ A
return44 
urlViewModelList44 #
;44# $
}55 	
private77 
string77 
GetRandomString77 &
(77& '
)77' (
{88 	
Random99 
random99 
=99 
new99 
Random99  &
(99& '
)99' (
;99( )
const:: 
string:: 
chars:: 
=::  
$str::! a
;::a b
return;; 
new;; 
string;; 
(;; 

Enumerable;; (
.;;( )
Repeat;;) /
(;;/ 0
chars;;0 5
,;;5 6
$num;;7 8
);;8 9
.<< 
Select<< 
(<< 
s<< 
=><< 
s<< 
[<< 
random<< %
.<<% &
Next<<& *
(<<* +
s<<+ ,
.<<, -
Length<<- 3
)<<3 4
]<<4 5
)<<5 6
.<<6 7
ToArray<<7 >
(<<> ?
)<<? @
)<<@ A
;<<A B
}== 	
}>> 
}?? Õ
/D:\temp\UrlShortener\UrlShortener\Models\Url.cs
	namespace 	
UrlShortener
 
. 
Models 
{ 
public 

class 
Url 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
UserUrl 
{ 
get  #
;# $
set% (
;( )
}* +
public		 
string		 

ShortedUrl		  
{		! "
get		# &
;		& '
set		( +
;		+ ,
}		- .
public 
int 
Clics 
{ 
get 
; 
set  #
;# $
}% &
} 
} £
?D:\temp\UrlShortener\UrlShortener\Models\UrlShortenerContext.cs
	namespace 	
UrlShortener
 
. 
Models 
{ 
public 

class 
UrlShortenerContext $
:% &
	DbContext' 0
{ 
public 
DbSet 
< 
Url 
> 
Urls 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 
UrlShortenerContext		 "
(		" #
DbContextOptions		# 3
<		3 4
UrlShortenerContext		4 G
>		G H
options		I P
)		P Q
:

 
base

 
(

 
options

 
)

 
{ 	
Database 
. 
EnsureCreated "
(" #
)# $
;$ %
} 	
} 
} ö
8D:\temp\UrlShortener\UrlShortener\Models\UrlViewModel.cs
	namespace 	
UrlShortener
 
. 
Models 
{ 
public 

class 
UrlViewModel 
{ 
public 
int 
? 
Id 
{ 
get 
; 
set !
;! "
}# $
public 
string 
UserUrl 
{ 
get  #
;# $
set% (
;( )
}* +
public		 
string		 

ShortedUrl		  
{		! "
get		# &
;		& '
set		( +
;		+ ,
}		- .
public 
int 
Clics 
{ 
get 
; 
set  #
;# $
}% &
} 
} †

,D:\temp\UrlShortener\UrlShortener\Program.cs
	namespace

 	
UrlShortener


 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	
CreateHostBuilder 
( 
args "
)" #
.# $
Build$ )
() *
)* +
.+ ,
Run, /
(/ 0
)0 1
;1 2
} 	
public 
static 
IHostBuilder "
CreateHostBuilder# 4
(4 5
string5 ;
[; <
]< =
args> B
)B C
=>D F
Host 
.  
CreateDefaultBuilder %
(% &
args& *
)* +
. $
ConfigureWebHostDefaults )
() *

webBuilder* 4
=>5 7
{ 

webBuilder 
. 

UseStartup )
<) *
Startup* 1
>1 2
(2 3
)3 4
;4 5
} 
) 
; 
} 
} Ö
,D:\temp\UrlShortener\UrlShortener\Startup.cs
	namespace		 	
UrlShortener		
 
{

 
public 

class 
Startup 
{ 
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
string 

connection 
= 
Configuration  -
.- .
GetConnectionString. A
(A B
$strB U
)U V
;V W
services 
. 
AddDbContext !
<! "
UrlShortenerContext" 5
>5 6
(6 7
options7 >
=>? A
optionsB I
.I J
UseSqlServerJ V
(V W

connectionW a
)a b
)b c
;c d
services 
. #
AddControllersWithViews ,
(, -
)- .
;. /
} 	
public 
void 
	Configure 
( 
IApplicationBuilder 1
app2 5
,5 6
IWebHostEnvironment7 J
envK N
)N O
{ 	
if 
( 
env 
. 
IsDevelopment !
(! "
)" #
)# $
{   
app!! 
.!! %
UseDeveloperExceptionPage!! -
(!!- .
)!!. /
;!!/ 0
}"" 
else## 
{$$ 
app%% 
.%% 
UseExceptionHandler%% '
(%%' (
$str%%( 5
)%%5 6
;%%6 7
app&& 
.&& 
UseHsts&& 
(&& 
)&& 
;&& 
}'' 
app(( 
.(( 
UseHttpsRedirection(( #
(((# $
)(($ %
;((% &
app)) 
.)) 
UseStaticFiles)) 
()) 
)))  
;))  !
app++ 
.++ 

UseRouting++ 
(++ 
)++ 
;++ 
app-- 
.-- 
UseAuthorization--  
(--  !
)--! "
;--" #
app// 
.// 
UseEndpoints// 
(// 
	endpoints// &
=>//' )
{00 
	endpoints11 
.11 
MapControllerRoute11 ,
(11, -
name22 
:22 
$str22 #
,22# $
pattern33 
:33 
$str33 ?
)33? @
;33@ A
}44 
)44 
;44 
}55 	
}66 
}77 